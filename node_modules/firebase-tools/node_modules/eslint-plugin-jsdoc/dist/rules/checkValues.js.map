{"version":3,"sources":["../../src/rules/checkValues.js"],"names":["allowedKinds","Set","utils","report","context","options","allowedLicenses","allowedAuthors","numericOnlyVariation","licensePattern","forEachPreferredTag","jsdocParameter","targetTagName","version","getTagDescription","trim","semver","valid","kind","has","join","variation","Number","isInteger","licenseRegex","getRegexFromString","matches","matchAll","positiveMatch","match","license","includes","author","iterateAllJsdocs","meta","docs","description","url","schema","additionalProperties","properties","items","type","anyOf"],"mappings":"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","sourcesContent":["import semver from 'semver';\nimport spdxExpressionParse from 'spdx-expression-parse';\nimport iterateJsdoc from '../iterateJsdoc';\n\nconst allowedKinds = new Set([\n  'class',\n  'constant',\n  'event',\n  'external',\n  'file',\n  'function',\n  'member',\n  'mixin',\n  'module',\n  'namespace',\n  'typedef',\n]);\n\nexport default iterateJsdoc(({\n  utils,\n  report,\n  context,\n}) => {\n  const options = context.options[0] || {};\n  const {\n    allowedLicenses = null,\n    allowedAuthors = null,\n    numericOnlyVariation = false,\n    licensePattern = '/([^\\n\\r]*)/gu',\n  } = options;\n\n  utils.forEachPreferredTag('version', (jsdocParameter, targetTagName) => {\n    const version = utils.getTagDescription(jsdocParameter).trim();\n    if (!version) {\n      report(\n        `Missing JSDoc @${targetTagName} value.`,\n        null,\n        jsdocParameter,\n      );\n    } else if (!semver.valid(version)) {\n      report(\n        `Invalid JSDoc @${targetTagName}: \"${utils.getTagDescription(jsdocParameter)}\".`,\n        null,\n        jsdocParameter,\n      );\n    }\n  });\n\n  utils.forEachPreferredTag('kind', (jsdocParameter, targetTagName) => {\n    const kind = utils.getTagDescription(jsdocParameter).trim();\n    if (!kind) {\n      report(\n        `Missing JSDoc @${targetTagName} value.`,\n        null,\n        jsdocParameter,\n      );\n    } else if (!allowedKinds.has(kind)) {\n      report(\n        `Invalid JSDoc @${targetTagName}: \"${utils.getTagDescription(jsdocParameter)}\"; ` +\n        `must be one of: ${[\n          ...allowedKinds,\n        ].join(', ')}.`,\n        null,\n        jsdocParameter,\n      );\n    }\n  });\n\n  if (numericOnlyVariation) {\n    utils.forEachPreferredTag('variation', (jsdocParameter, targetTagName) => {\n      const variation = utils.getTagDescription(jsdocParameter).trim();\n      if (!variation) {\n        report(\n          `Missing JSDoc @${targetTagName} value.`,\n          null,\n          jsdocParameter,\n        );\n      } else if (\n        !Number.isInteger(Number(variation)) ||\n        Number(variation) <= 0\n      ) {\n        report(\n          `Invalid JSDoc @${targetTagName}: \"${utils.getTagDescription(jsdocParameter)}\".`,\n          null,\n          jsdocParameter,\n        );\n      }\n    });\n  }\n\n  utils.forEachPreferredTag('since', (jsdocParameter, targetTagName) => {\n    const version = utils.getTagDescription(jsdocParameter).trim();\n    if (!version) {\n      report(\n        `Missing JSDoc @${targetTagName} value.`,\n        null,\n        jsdocParameter,\n      );\n    } else if (!semver.valid(version)) {\n      report(\n        `Invalid JSDoc @${targetTagName}: \"${utils.getTagDescription(jsdocParameter)}\".`,\n        null,\n        jsdocParameter,\n      );\n    }\n  });\n  utils.forEachPreferredTag('license', (jsdocParameter, targetTagName) => {\n    const licenseRegex = utils.getRegexFromString(licensePattern, 'g');\n    const matches = utils.getTagDescription(jsdocParameter).matchAll(licenseRegex);\n    let positiveMatch = false;\n    for (const match of matches) {\n      const license = match[1] || match[0];\n      if (license) {\n        positiveMatch = true;\n      }\n\n      if (!license.trim()) {\n        // Avoid reporting again as empty match\n        if (positiveMatch) {\n          return;\n        }\n\n        report(\n          `Missing JSDoc @${targetTagName} value.`,\n          null,\n          jsdocParameter,\n        );\n      } else if (allowedLicenses) {\n        if (allowedLicenses !== true && !allowedLicenses.includes(license)) {\n          report(\n            `Invalid JSDoc @${targetTagName}: \"${license}\"; expected one of ${allowedLicenses.join(', ')}.`,\n            null,\n            jsdocParameter,\n          );\n        }\n      } else {\n        try {\n          spdxExpressionParse(license);\n        } catch {\n          report(\n            `Invalid JSDoc @${targetTagName}: \"${license}\"; expected SPDX expression: https://spdx.org/licenses/.`,\n            null,\n            jsdocParameter,\n          );\n        }\n      }\n    }\n  });\n\n  utils.forEachPreferredTag('author', (jsdocParameter, targetTagName) => {\n    const author = utils.getTagDescription(jsdocParameter).trim();\n    if (!author) {\n      report(\n        `Missing JSDoc @${targetTagName} value.`,\n        null,\n        jsdocParameter,\n      );\n    } else if (allowedAuthors && !allowedAuthors.includes(author)) {\n      report(\n        `Invalid JSDoc @${targetTagName}: \"${utils.getTagDescription(jsdocParameter)}\"; expected one of ${allowedAuthors.join(', ')}.`,\n        null,\n        jsdocParameter,\n      );\n    }\n  });\n}, {\n  iterateAllJsdocs: true,\n  meta: {\n    docs: {\n      description: 'This rule checks the values for a handful of tags: `@version`, `@since`, `@license` and `@author`.',\n      url: 'https://github.com/gajus/eslint-plugin-jsdoc#eslint-plugin-jsdoc-rules-check-values',\n    },\n    schema: [\n      {\n        additionalProperties: false,\n        properties: {\n          allowedAuthors: {\n            items: {\n              type: 'string',\n            },\n            type: 'array',\n          },\n          allowedLicenses: {\n            anyOf: [\n              {\n                items: {\n                  type: 'string',\n                },\n                type: 'array',\n              },\n              {\n                type: 'boolean',\n              },\n            ],\n          },\n          licensePattern: {\n            type: 'string',\n          },\n          numericOnlyVariation: {\n            type: 'boolean',\n          },\n        },\n        type: 'object',\n      },\n    ],\n    type: 'suggestion',\n  },\n});\n"],"file":"checkValues.js"}